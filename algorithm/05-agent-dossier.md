---
title: "Pipeline Stage 3 ‚Äî The Agent Dossier"
parent: Algorithm Reference
nav_order: 5
---

## Section 5: Pipeline Stage 3 ‚Äî The Agent Dossier

### 5.1 What is the Dossier?

The `agent_dossier` is a Gemini-synthesised JSON identity card that consolidates everything known about a user into a single, human-readable + machine-readable object. It is generated by the `update-dossier` edge function.

### 5.2 Schema

```json
{
  "archetype_name": "The Quiet Architect",
  "archetype_emoji": "üèõÔ∏è",
  "vibe_keywords": ["introspective", "precise", "warm"],
  "attracted_to": ["The Soulful Creator", "The Grounded Explorer"],
  "dealbreakers_learned": ["Avoids Superficial Conversations", "Avoids High Drama Energy"],
  "agent_strategy": "Prioritising depth-first matches ‚Äî filtering for intellectual curiosity and measured emotional expressiveness before aesthetic alignment.",
  "astrological_compatibility_vibe": "Born under Capricorn energy with Mumbai's ambitious undertone, they seek a partner who balances ambition with tenderness ‚Äî someone who plans for the future but knows how to savour the present.",
  "generated_at": "2025-11-14T23:11:00.000Z"
}
```

### 5.3 Generation Logic

1. Fetch `aesthetic_vibe`, `core_hobbies`, `harmony_score`, `occupation`, `vibe_summary`, `dob`, `lob` from `profiles`
2. Fetch up to 5 most-recent negative `agent_constraints` (see Section 8) and render as readable dealbreakers
3. Call Gemini 2.0 Flash (temperature 0.7, max 8192 tokens) with a structured prompt
4. Validate all 7 required fields are present; reject partial responses
5. Write to `profiles.agent_dossier`

The dossier is regenerated each time `update-dossier` is called ‚Äî both at the end of onboarding and any time `agent_constraints` accumulate enough new signal.

